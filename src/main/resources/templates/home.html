<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Smart Code Review - Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Welcome to Smart Code Review</h1>
        <p>AI-powered code analysis using Amazon Nova</p>
        
        <div class="card mt-4">
            <div class="card-body">
                <h5 class="card-title">Get Started</h5>
                <form th:action="@{/auth/session/create}" method="post">
					<div class="mb-3">
					    <label for="email" class="form-label">Email Address</label>
					    <input type="email" class="form-control" id="email" name="email" required>
					    <div class="form-text">We'll send you a verification code.</div>
					</div>

					<!-- New GitHub Token Section -->
					<div class="card bg-light border-info mt-4 mb-3">
					    <div class="card-body">
					        <h5 class="card-title"><i class="bi bi-github"></i> GitHub Personal Access Token Required</h5>
					        <p class="card-text">To analyze your repositories, you need to provide a GitHub Personal Access Token.</p>
					        
					        <div class="mb-3">
					            <label for="githubToken" class="form-label">GitHub Token <span class="text-danger">*</span></label>
					            <input type="password" class="form-control" id="githubToken" name="githubToken" 
					                   placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" required
					                   pattern="ghp_[a-zA-Z0-9]{36}" 
					                   title="Please enter a valid GitHub token starting with 'ghp_'">
					            <div class="form-text">Your token is never stored and is used only for this session.</div>
					        </div>
					        
					        <div class="accordion" id="tokenInstructions">
					            <div class="accordion-item">
					                <h2 class="accordion-header" id="headingOne">
					                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" 
					                            data-bs-target="#collapseOne" aria-expanded="false">
					                        üìñ How to Generate a GitHub Token
					                    </button>
					                </h2>
					                <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#tokenInstructions">
					                    <div class="accordion-body">
					                        <ol>
					                            <li>Go to <a href="https://github.com/settings/tokens/new" target="_blank" class="text-decoration-none">
					                                GitHub Token Settings <i class="bi bi-box-arrow-up-right"></i></a></li>
					                            <li>Give your token a descriptive name (e.g., "Smart Code Review")</li>
					                            <li>Set expiration (we recommend 7 days for security)</li>
					                            <li>Select scopes:
					                                <ul>
					                                    <li><code>repo</code> - Full control of private repositories (required)</li>
					                                    <li>No other permissions needed!</li>
					                                </ul>
					                            </li>
					                            <li>Click "Generate token" at the bottom</li>
					                            <li>Copy the token (starts with <code>ghp_</code>)</li>
					                            <li>Paste it in the field above</li>
					                        </ol>
					                        <div class="alert alert-warning mt-3">
					                            <i class="bi bi-exclamation-triangle"></i> <strong>Important:</strong> 
					                            Copy your token immediately! GitHub won't show it again.
					                        </div>
					                    </div>
					                </div>
					            </div>
					        </div>
					    </div>
					</div>

					<div class="alert alert-info">
					    <h6><i class="bi bi-shield-check"></i> Security & Privacy</h6>
					    <ul class="mb-0">
					        <li>Your token is transmitted securely over HTTPS</li>
					        <li>We use your token only during this session</li>
					        <li>Token is automatically deleted after 1 hour</li>
					        <li>We never store tokens in our database</li>
					    </ul>
					</div>
                    <button type="submit" class="btn btn-primary">Start Session</button>
                </form>
            </div>
        </div>
    </div>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
	<script>
	document.getElementById('githubToken').addEventListener('blur', function() {
	    const token = this.value;
	    if (token && token.startsWith('ghp_')) {
	        // Validate token via AJAX
	        fetch('/auth/validate-token', {
	            method: 'POST',
	            headers: {'Content-Type': 'application/json'},
	            body: JSON.stringify({token: token})
	        })
	        .then(response => response.json())
	        .then(data => {
	            const feedback = document.getElementById('tokenFeedback');
	            if (data.valid) {
	                feedback.innerHTML = `<span class="text-success">‚úÖ Valid token for user: ${data.username} (${data.rateLimit} API calls remaining)</span>`;
	            } else {
	                feedback.innerHTML = `<span class="text-danger">‚ùå ${data.error}</span>`;
	            }
	        });
	    }
	});
	</script>
</body>
</html>